# 데이터베이스 핵심 개념 설명

## 🤔 **임베딩(Embedding)이란?**

### **간단한 비유**
- **텍스트를 숫자로 변환**하는 작업
- 마치 "사과"라는 단어를 `[0.1, 0.3, -0.2, ...]` 같은 숫자 배열로 바꾸는 것

### **왜 필요한가?**
```
사용자 질문: "회계 관련 문서 찾아줘"
↓
임베딩 변환: [0.2, -0.1, 0.8, ...] (768개 숫자)
↓
비슷한 의미의 문서/채팅을 찾을 수 있음
```

### **RAGbot에서의 활용**
- **세션 임베딩**: 전체 대화 내용을 하나의 숫자 배열로 변환 ✅ **선택됨**
- **메시지 임베딩**: 개별 메시지를 숫자 배열로 변환 ❌ **미선택**
- **문서 임베딩**: 업로드된 문서 내용을 숫자 배열로 변환

### **선택된 저장 방식**
```
✅ 세션별만 저장 (선택됨)
- 전체 대화를 하나의 임베딩으로 저장
- "이 대화는 회계 관련이야" 정도로만 검색 가능
- 장점: 단순함, 저장 공간 절약
- 단점: 개별 메시지 검색 불가
```

---

## 🔍 **인덱스(Index)란?**

### **간단한 비유**
- **책의 목차**와 같은 역할
- 데이터를 빠르게 찾기 위한 "색인표"

### **일반 인덱스 vs 벡터 인덱스**
```
일반 인덱스 (책의 목차):
- "회계" → 15페이지
- "마케팅" → 32페이지

벡터 인덱스 (의미 기반):
- "회계" 임베딩 [0.2, -0.1, 0.8, ...]
- 비슷한 의미의 다른 임베딩들을 빠르게 찾기
```

### **인덱스 종류**

#### **HNSW 인덱스** ✅ **선택됨**
```
장점: 매우 빠른 검색 속도
단점: 메모리를 많이 사용
적합한 경우: 검색 속도가 중요한 경우
```

#### **IVFFlat 인덱스** ❌ **미선택**
```
장점: 메모리 효율적
단점: 상대적으로 느린 검색
적합한 경우: 메모리가 제한적인 경우
```

### **RAGbot에서의 활용**
- 채팅 세션 검색: "회계 관련 대화 찾기"
- 문서 검색: "비슷한 내용의 문서 찾기"
- 메시지 검색: "특정 질문과 비슷한 메시지 찾기"

---

## 📊 **파티셔닝(Partitioning)이란?**

### **간단한 비유**
- **큰 테이블을 작은 조각들로 나누는** 작업
- 마치 "2024년 데이터", "2025년 데이터"로 나누는 것

### **왜 필요한가?**
```
파티셔닝 없이:
- 모든 데이터가 하나의 큰 테이블에 저장
- 데이터가 많아질수록 검색이 느려짐

파티셔닝 적용:
- 월별로 테이블을 나눔
- "2024년 1월 데이터만 검색" → 빠른 속도
```

### **파티셔닝 방식**

#### **시간 기반 파티셔닝**
```sql
-- 원본 테이블
chat_messages (모든 메시지)

-- 파티션 테이블들
chat_messages_2024_01 (2024년 1월 메시지)
chat_messages_2024_02 (2024년 2월 메시지)
chat_messages_2024_03 (2024년 3월 메시지)
```

#### **사용자 기반 파티셔닝**
```sql
-- client_id별로 나누기
chat_sessions_client_001 (특정 사용자의 세션)
chat_sessions_client_002 (다른 사용자의 세션)
```

### **장단점**
```
장점:
- 검색 속도 향상
- 백업/복구 효율성
- 유지보수 용이성

단점:
- 복잡한 구조
- 관리 오버헤드
- 초기 설정 비용
```

### **선택된 전략**
```
❌ 파티셔닝 미적용 (선택됨)
- 현재 단계에서는 검색 속도가 느려질 때까지 불필요
- 단순한 구조로 개발 우선
- 향후 필요시 확장 가능 (manual/partitioning-expansion.md 참조)
```

---

## 🎯 **RAGbot에서의 실제 적용**

### **임베딩 저장 전략**
```
사용자: "회계 관련 대화 찾아줘"
↓
시스템: 모든 채팅 세션의 임베딩과 비교
↓
결과: "회계 관련 대화 3개 발견"
```

### **인덱스 활용**
```
사용자: "예산 관련 질문"
↓
HNSW 인덱스: 빠르게 비슷한 의미의 문서/대화 찾기
↓
결과: 0.1초 내에 관련 결과 반환
```

### **파티셔닝 효과**
```
사용자: "최근 1개월 대화만 검색"
↓
파티셔닝: 2024년 1월 테이블만 검색
↓
결과: 전체 데이터 대비 10배 빠른 검색
```

---

## 🤔 **선택 기준**

### **MVP 단계 (현재)** ✅ **적용됨**
- **임베딩**: 세션별만 (단순함 우선)
- **인덱스**: HNSW (빠른 검색 우선)
- **파티셔닝**: 미적용 (단순함 우선)

### **확장 단계 (향후)**
- **임베딩**: 메시지별 추가 (세밀한 검색)
- **인덱스**: 필요시 IVFFlat 고려 (메모리 최적화)
- **파티셔닝**: 데이터 증가시 적용 (성능 최적화)

---

## 💡 **핵심 요약**

1. **임베딩**: 텍스트를 숫자로 변환해서 의미 기반 검색
2. **인덱스**: 빠른 검색을 위한 "색인표"
3. **파티셔닝**: 큰 테이블을 작은 조각으로 나누기

**RAGbot에서는 이 세 가지를 조합해서 "의미 있는 검색"을 빠르게 제공합니다!**

---

## 📋 **최종 선택사항**

- ✅ **임베딩**: 세션별만 저장
- ✅ **인덱스**: HNSW 사용
- ❌ **파티셔닝**: 현재 미적용 (향후 확장 고려)